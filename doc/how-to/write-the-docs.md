# Writing Documentation for Batteries C++

Batteries is a work in progress, but our aim is to provide the best documentation possible for our users.  This guide desecribes the tools and process we use to write, build, and deploy documentation.

## Quick Start

From the Git repo root, run the shell command:

```shell
make serve-docs
```

Expected output:

```
...
INFO     -  [17:56:51] Serving on http://127.0.0.1:8000/
```

Now you should be able to navigate to [http://localhost:8000/](http://localhost:8000/) and view the documentation site served by your development machine.  Any changes made to the source files will be reflected automatically be reflected after running:

```shell
make mkdocs
```

_** NOTE: ** The shell commands in this document assume you have the documentation tools installed.  If you want to install them on your machine natively, you can check `batteries/docker/Dockerfile` to see how they are installed for CI pipelines.  The recommended method, however, is to run all commands inside a Docker container using the `batteries/script/run-with-docker.sh` script.  Example:

```shell
script/run-with-docker.sh make serve-docs
```

### What to Edit

- src/ <br> _Doxygen-style comments in C++ source files_
- config/ <br> _Doc tool configuration and customization_
    - mkdocs.yml <br> _Site navigation tree_
    - mkdocs\_overrides/ <br> _General HTML layout customization_
    - doxybook\_templates/ <br> _Generated API Reference HTML layout customization_
- doc/ <br> _Handwritten markdown files (subdirs are OK too!)_
    - images/ <br> _Static image assets_
    - stylesheets/ <br> _Handwritten CSS_

## Overview

The [documentation site of Batteries C++](https://batteriescpp.github.io) is hosted by [GitHub Pages](https://pages.github.com/).  There are many source materials that go into building the site:

 - Hand-written MarkDown files (such as this one)
 - Doxygen-style Doc Comments in the C++ Source Code
 - Static Web Assets (e.g., images, css, etc.)
 - Metadata that describes the site structure and the build process

### MkDocs

At the top level, the site is statically generated using [MkDocs](https://www.mkdocs.org/).  The MkDocs project is constructed from files gathered from various places in the Git repo, as well as automatically generated content produced by scraping the source code.  The basic structure of a MkDocs project is:

 - project/  <br> _The project root directory_
    - mkdocs.yml  <br> _The MkDocs config file_
    - docs/  <br> _The site source files_
        - images/  <br> _Base directory for image files_
        - stylesheets/  <br> _Base directory for CSS style sheets_
    - overrides/  <br> _Theme partial layout overrides_

The MkDocs project for Batteries is generated inside `batteries/build/mkdocs/` by the Makefile target `mkdocs`:

```shell
make mkdocs
```

_** NOTE: ** The `mkdocs` target depends on the `doxygen` and `doxybook2` targets, so you don't need to run those separately._

#### mkdocs.yml

The source file for `mkdocs.yml` lives at `batteries/config/mkdocs.yml`.  This is where you configure:

 - The site name ("Batteries C++")
 - The theme (we currently use a customized version of [Material](https://squidfunk.github.io/mkdocs-material/))
 - The locations of any extra .css files
 - The site navigation tree (which appears on the right sidebar)
 - Plugins and MarkDown language extensions

#### docs/

All handwritten files inside the MkDocs `docs/` dir are copied from `batteries/doc/`.  In addition, the Makefile creates a subdir called `_autogen/` under `docs/` containing all content generated by Doxygen and Doxybook2 (see below).

#### overrides/

This directory is copied from `batteries/config/mkdocs_overrides/`.  It contains all HTML layout customizations to the [Material](https://squidfunk.github.io/mkdocs-material/) theme.  For more information, [read this document](https://squidfunk.github.io/mkdocs-material/customization/#extending-the-theme).

### Doxygen/Doxybook2

We scrape the C++ source code inside `batteries/src/` using [Doxygen](https://doxygen.nl/) to extract API documentation.  The Doxygen config file lives at `batteries/config/doxygen.config`, and the corresponding output is produced in `batteries/build/doxygen/'.

To run just the Doxygen tool, you can run the Makefile like this:

```shell
make doxygen
```

_** NOTE: ** The `doxygen` target depends on the `doxybook2` target, so you don't need to run it separately._

The default Doxygen HTML output looks much worse than what MkDocs produces, and it isn't styled according to the [Material](https://squidfunk.github.io/mkdocs-material/) theme.  To bridge the gap, we use [Doxybook2](https://github.com/matusnovak/doxybook2#doxybook2).  Doxybook2 takes the XML output of Doxygen and produces MarkDown files which can be formatted and styled in a manner consistent with the rest of the site.

The Doxybook2 config file lives at `batteries/config/doxybook_config.json`.  The templates used to generate MarkDown live inside `batteries/config/doxybook_templates/`.  You can read about how to modify these [here](https://github.com/matusnovak/doxybook2#Templates).

Doxybook2 output is generated inside `batteries/build/doxybook2/`.  You can regenerate this output using:

```shell
make doxybook2
```
